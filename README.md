# 智能物流搬运小车
本项目是中国大学生工程实践与创新能力大赛中“智能+”赛道的智能物流搬运赛项。  
Collaborators:[CY](https://github.com/CycleYerik)

## Contents
<!-- - [CCC_crazy_carrier_car](./CCC_crazy_carrier_car): 项目的主程序代码工程，基于CubeMX生成，使用HAL库函数和Keil5
    - [car_control](./CCC_crazy_carrier_car/car_control): 小车的运动控制、机械臂控制等进行功能实现和封装
    - [screen](./CCC_crazy_carrier_car/screen): 显示屏驱动和显示函数，便于调试
    - [sensor](./CCC_crazy_carrier_car/sensor): 传感器驱动和数据处理
    - [servo](./CCC_crazy_carrier_car/servo): 机械臂舵机相关驱动
    - [motor](./CCC_crazy_carrier_car/motor): 步进电机相关驱动
    - [Core](./CCC_crazy_carrier_car/Core): 主程序代码main.c所在
    - 其余文件夹和文件为CubeMX生成的相关工程文件
- [OpenCV](./OpenCV): 项目的图像处理代码工程，基于树莓派，使用OpenCV -->




## 使用

### 注意事项  
1. 本项目使用的主控为STM32F407Vet6，使用CubeMX生成工程，使用Keil5进行编译和烧录。自己建立工程进行调试时相对应的时钟配置等可参考本工程
2. 项目将各个模块分开管理，各自调试好驱动，实现功能，给出函数的调用接口或者封装好的功能函数，在主程序中直接调用，这样便于各自模块的调试和管理，最后的main函数里也调用的都是封装好的功能函数，这样代码逻辑也较为清晰。同时建议在各个文件夹中完善README.md文件，给出各个模块的使用方法和接口，说清楚各个函数的作用和参数，而不是就一个.c和.h文件。
3. 各个模块最好能在模块文件中就实现了各种配置和初始化，而不是还要在cubeMX中进行配置（当然基本的一些外设也可以在cubemx中配置。
4. keil编译工程时可能出现中文注释变成乱码的问题，建议自行上网查找解决方法(修改编译时的编码)或者干脆用英文注释，但是务必保证用英语能够清晰表达。
5. 注意keil的main函数中代码要写在user code begin和user code end之间，不要写在其他地方，否则重新生成代码时会被覆盖。
6. 添加了新的.c和.h文件后，需要在keil工程中添加相应的文件，否则编译时会报错（具体如何添加去网上找教程）

## 进度
2024.10.8
- 实现了串口屏、树莓派的通信和返回数据的初步处理
- 实现了电机的控制，但是底盘控制仍然有问题
- 实现了普通舵机的控制

2024.10.15
- 主控改回STM32F407vet6
- 实现了底盘的位置控制（移动给定距离、旋转给定角度），能达到毫米级别的控制
- 视觉的识别，能做到识别二维码、圆心等，但抗干扰情况和识别速度有待优化

2024.10.17
- 实现了树莓派和电机的联调，可以实现简单的视觉定位

2024.10.26
- 采用了新的PCB拓展板，加入了STM32的开关、精密舵机的接口等
- 实现了精密舵机的基本控制

2024.11.8
- 重装车后（采用玻纤板），重新调试了各个舵机的参数


## 任务和要求（目前和长远）

### 近期任务
- 视觉和主控的通信。能传输视觉识别的数据，并规定数据格式
- 视觉与底盘的协调。能根据视觉识别的数据调整底盘的运动（包括位置式PID等）
- 优化程序结构。处理好各种通信和控制的关系，封装好各个函数
- 机械运动控制的规划。测试好各个动作对应的参数
- 陀螺仪驱动和数据读取。能够读取陀螺仪的数据，并且根据数据进行车辆位置校正
- 串口通信优化，改为使用DMA，降低CPU占用率

### 长远任务和功能要求


#### 运动控制
- 速度模式引入PID，实现稳定的速度控制（暂时先不考虑）
- 借助陀螺仪等传感器，实现行驶校正
- 实现给定路径的开环控制行驶
- 能够根据视觉的情况来进行辅助的校正


#### 视觉
- 跑一个简单的深度学习，加强颜色识别的效果和速度
- 优化程序设计，保证识别速度、准确度（是否能快速识别，一次完成等）
- 借助视觉对小车直线行驶进行辅助校正

#### 机械臂
- 优化机械结构，避免甩尾等影响
- 尝试增加机械臂的伸出长度和转动角度
- 加快抓取和放置的速度
- 参考网上各种设计，进行方案的改版甚至重构

#### 整车结构设计
- 尽量减小体积，保证承重情况
- 优化各种连接件的设计，避免松动、折断等情况(主要是485模块接线容易松动)
- 优化折叠的设计
- 加入陀螺仪，进行校正

#### 供电和电源管理
- PCB完善设计，保证大功率长时间运行的安全性，保证各种供电的稳定性

#### 程序设计
- 采用rtos进行任务调度或者自己设计一个简单的调度器
- 优化程序的框架（处理好通信、行为控制等的顺序和优先级）
- 程序的解耦合（把各个模块的参数等分开，避免混乱）
- 程序风格和语言的优化（如注释、变量命名等）

#### 备份和预案准备
- 零件的替换和余量：比如联轴器、电机支架或者一些连接件等各种易损元件最好有备份的零件，直接可以换上的那种
- 设计和修改的余量：在国赛中物料可能会有各种花活，所以尽可能留足更改的可能与空间（比如物料盘尽量大一点）


## 碎碎念
1. 别问为什么用keil和CubeMX而不用CubeIDE这种明显更现代的平台，问就是祖宗之法不可变。
2. 改程序尽量注释而不是直接删掉，防止改完后忘了原来的情况
3. 调车经验之谈：上电前务必三思，防止烧器件、忘了调参、忘了关电源等等；不要与一个问题或者故障死磕太久，防止陷入死胡同；最好不要一个人调。